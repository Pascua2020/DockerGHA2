Hashtags #ï¸âƒ£ : #devops #docker #linux #automation #ci #github-actions #dokku #java-springboot #nginx

### English-Version README.Para leer la VersiÃ³n en EspaÃ±ol,ve a README.md

# âœ…ï¸ DockerGHA2


![Build Status](https://github.com/Pascua2020/DockerGHA/actions/workflows/main.yml/badge.svg)
![Version](https://img.shields.io/badge/version-1.0.0-blue)
![Docker](https://img.shields.io/badge/container-Docker-blue?logo=docker&logoColor=white)
![GitHub Actions](https://img.shields.io/badge/CI-GitHub%20Actions-blue?logo=githubactions&logoColor=white)
![Dokku](https://img.shields.io/badge/deployment-Dokku-blueviolet?logo=dokku)
![No License](https://img.shields.io/badge/license-None-red) 
![English](https://img.shields.io/badge/language-english-blue?style=flat-square&logo=google-translate)

( Docker, GitHub Actions, Java Spring Boot, and Dokku )

![DevOps Logo](https://globalittrainers.com/wp-content/uploads/2021/06/Devops-logo1.png)

```diff
- This project demonstrates how to integrate Docker, GitHub Actions, Java Spring Boot, and Dokku to create an automated development and deployment workflow.

- The application is a basic Spring Boot service running inside a Docker container, automated with GitHub Actions, and deployed using Dokku.
```

## 1ï¸âƒ£ğŸŸ¥ Features

*âš¡ï¸ Docker:*

![Docker Logo](https://dwglogo.com/wp-content/uploads/2017/09/Docker_container_engine_logo.png)

Packages the Spring Boot application in a container to ensure it runs consistently in any environment.

*âš¡ï¸ GitHub Actions:*

![GHA Logo](https://miro.medium.com/v2/resize:fit:1075/0*w5Fsp29pbWIUpW7Q.png)

Automates the build, test, and deployment processes for the application with each change in the repository.

*âš¡ï¸ Java Spring Boot:*

![Java SB Logo](https://miro.medium.com/v2/resize:fit:720/format:webp/1*MvUFlFTbiU40ae1SK69-Jg.png)

Backend framework for web application development.

*âš¡ï¸ Dokku:*

![Dokku Logo](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6mNvZ4G3tFQpY1qcVDQdWGSVUW5ljKhyUxfgTeFAZUX5r48Xm8M6mMf55h3IkCw1DC3ERygHIWgsvguq1cYntoluBXdW4-7W_Uhw8JHrvQIeW5T1lIGOuk7WTvkP5O-M_XR4J-6W9Gg-vfhG6B-Q6w75EaJ_eHlGvjxcbEGB3_xckw6OnTwxuBWsL-TRQ/s2800/A%20Deep%20Dive%20with%20Dokku.webp)

A Heroku-like deployment platform that uses Docker containers to manage applications easily.

### Differences between DockerGHA 1, 2, 3, and 4:

âš ï¸ *All Dockerfiles are identical:*

- Use the base image busybox:latest.

- Copy a run.sh script into the container, which prints the current time in the console in an infinite loop.

- Configure the run.sh script as the container's entry point.


âš ï¸ *Main.yml - General differences:*

*â„¹ï¸ 1. Repositories:*


- 1 and 2 push images only to Docker Hub.

- 3 pushes only to GHCR.

- 4 pushes to both registries (Docker Hub and GHCR).


*â„¹ï¸ 2. Automation:*

- Repositories 2, 3, and 4 use docker/metadata-action for automatic tagging, while 1 does not.


*â„¹ï¸ 3. Image names:*

- Repository 1 has a fixed name: clockbox:latest.

- The other repositories use dynamic or specific configurations.


## 2ï¸âƒ£ğŸŸ§ Project Structure
```
DockerGHA2/
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ main.yml             # GitHub Actions workflow
â”œâ”€â”€ Dockerfile                   # Dockerfile for containerizing the app
â”œâ”€â”€ README.md                    # Project documentation
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/
â”‚   â”‚   â”‚       â””â”€â”€  DominioApplication.java   # Spring Boot main class
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.properties         # App configuration
â”œâ”€â”€ target/                       # Build directory (generated by Maven/Gradle)
â”œâ”€â”€ pom.xml                       # Maven configuration file (if using Maven)
â””â”€â”€ .gitignore                    # Files and directories to ignore in Git
```
*ğŸ’¾ Dockerfile:*

Defines how to build the Docker image for the Spring Boot project.

*ğŸ’¾ main.yml:*

GitHub Actions configuration file to automate building, testing, and deployment.

*ğŸ’¾ src/:*

Contains the source code for the Spring Boot application.

*ğŸ’¾ pom.xml:*

Maven configuration file for dependencies and project build.

*ğŸ’¾ dokku-deploy.sh:*

Script that automates the deployment process of the application to a remote server using Dokku.

## 3ï¸âƒ£ğŸŸ© Objectives of the Project

The purpose of this repository is to demonstrate the use of Docker, GitHub Actions, and Dokku in a unified DevOps workflow for building, testing, and deploying applications.

This workflow is highly modular and follows standard practices to ensure scalability and automation:

Containerize the application using Docker.

Implement CI/CD pipelines using GitHub Actions.

Automate deployment processes via Dokku.

## 4ï¸âƒ£ğŸŸ¨ Technologies Used

â–«ï¸ *Backend:*

ğŸ’¡Java Spring Boot: Provides a framework for developing microservices and REST APIs.

â–«ï¸ *Containers:*

ğŸ’¡Docker: Used to create, deploy, and run the application in containers, ensuring consistency across environments.

â–«ï¸ *Automation:*

ğŸ’¡GitHub Actions: Configured to automate the build, test, and deployment processes.

â–«ï¸ *Deployment:*

ğŸ’¡Dokku: Used to manage and deploy the application to a virtualized environment, simplifying application hosting.

â–«ï¸ *Others:*

ğŸ’¡Nginx: Used as a reverse proxy for the application to enhance performance and security.

## â¬œï¸ Code

ğŸ’¡ *Dockerfile*
```
# syntax=docker/dockerfile:1
FROM busybox:latest
COPY --chmod=755 <<EOF /app/run.sh
#!/bin/sh
while true; do
  echo -ne "The time is now $(date +%T)\\r"
  sleep 1
done
EOF

ENTRYPOINT /app/run.sh
```

This Dockerfile creates a lightweight container that continuously outputs the current time in a specific format.

ğŸ”·ï¸ 1. Base Image:

Uses the latest version of the busybox image, a minimal Linux distribution with essential utilities.

ğŸ”·ï¸ 2. Create and Copy a Shell Script:

Creates a shell script (run.sh) on the fly using a here-document (<<EOF ... EOF) and copies it to the /app/ directory inside the container.

The script:

Enters an infinite loop (while true) that:

Prints the current time in HH:MM:SS format.

Overwrites the same line in the terminal (echo -ne "..." with \\r to stay on the same line).

Waits for 1 second before repeating (sleep 1).

ğŸ”·ï¸ 3. Set File Permissions:

Sets executable permissions (chmod=755) for the run.sh script.

ğŸ”·ï¸ 4. Entry Point:

Defines /app/run.sh as the entry point, making it the default command executed when the container starts.

ğŸ”‘ Purpose:

When the container runs, it continuously prints the current time in real-time, updating it every second on the same terminal line.

ğŸ’¡ *Main.yml*
```
name: Publish Docker image

on:
  push:
    branches: ['main']

jobs:
  push_to_registry:
    name: Push Docker image to Docker Hub
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4

      - name: Log in to Docker Hub
        uses: docker/login-action@f4ef78c080cd8ba55a85445d5b36e214a81df20a
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Extract metadata (tags, labels) for Docker
        id: meta
        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7
        with:
          images: gonzaloescudero/my-docker-hub-repository

      - name: Build and push Docker image
        uses: docker/build-push-action@3b5e8027fcad23fda98b2e3ac259d8d67585f671
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
```
This GitHub Actions workflow is designed to automate the process of building and publishing a Docker image to Docker Hub when changes are pushed to the main branch.

ğŸ”·ï¸ Workflow Name:

Publish Docker image

ğŸ”·ï¸ Trigger:

Runs when there is a push to the main branch.

ğŸ”·ï¸ Job:

push_to_registry

Purpose: Builds a Docker image from the repository and pushes it to Docker Hub.

Runs-on: The job runs on the latest version of Ubuntu (ubuntu-latest).

ğŸ”·ï¸ Steps:

â–«ï¸ 1. Check Out the Repository:

Uses the actions/checkout action to clone the repository code into the runner environment.

â–«ï¸ 2. Log In to Docker Hub:

Uses the docker/login-action to authenticate with Docker Hub.

Credentials are securely retrieved using GitHub secrets (DOCKER_USERNAME and DOCKER_PASSWORD).

â–«ï¸ 3. Extract Metadata for the Docker Image:

Uses the docker/metadata-action to generate metadata such as tags and labels for the Docker image.

The metadata (e.g., tags and labels) is based on repository information and is stored in outputs (steps.meta.outputs.tags and steps.meta.outputs.labels).

â–«ï¸ 4. Build and Push Docker Image:

Uses the docker/build-push-action to:

Build the Docker image using the Dockerfile in the repository.

Push the image to the specified Docker Hub repository (gonzaloescudero/my-docker-hub-repository).

It uses the metadata (tags and labels) from the previous step to annotate the image.

ğŸ”‘ Purpose:

This workflow ensures that every change pushed to the main branch is automatically reflected as a new Docker image version in Docker Hub, complete with relevant tags and labels. It simplifies and streamlines the CI/CD process for Docker-based applications.

## 5ï¸âƒ£ğŸŸ¦ Project Status

```
â˜‘ï¸ Completed.
```

## 6ï¸âƒ£ğŸ‘¤ Collaboration

This project is for personal use and is not open to external contributions.
However, if you find it interesting or have any questions, Iâ€™ll be happy to hear them! Feel free to contact me on my GitHub profile.

## 7ï¸âƒ£ğŸŸª License

This project does not have an assigned license. Without an explicit license, all rights are reserved. If you wish to use this project, please contact me.

## 8ï¸âƒ£ğŸŸ« Authors

- *Pascua2020* (https://github.com/Pascua2020)

- *UTN*


## 9ï¸âƒ£ğŸ“’ Official Documentation:

*- Docker:*
https://docs.docker.com

*- GitHub Actions:*
https://docs.github.com/en/actions

*- Dokku:*
https://dokku.com/docs/getting-started/installation/

## ğŸ”ŸğŸ”„ Notes

*Security Considerations*

- This project uses secret variables (DOCKER_USERNAME, DOCKER_PASSWORD, GITHUB_TOKEN).

- Make sure to configure the secrets in the "Settings > Secrets and Variables > Actions" section of your repository.


*Project Limitations*

- This project does not include advanced orchestration setups like Kubernetes.

- It is designed for simple deployments in Docker-compatible environments.


*Additional Notes*

- This project is an educational example. 

- It is not recommended for use in production environments without making specific adjustments.
